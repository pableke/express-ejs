const IRSE={lang:"es"},IRSE_I18N={en:{msgRechazar:"¿Confirma que desea rechazar esta comunicación?",msgUnlink:"¿Confirma que desea desasociar esta operación de la comunicación?",msgReactivar:"¿Confirma que desea reactivar esta comunicación?",msgFirmar:"¿Confirma que desea firmar esta comunicación?",msgFirmarEnviar:"¿Confirma que desea firmar y enviar esta comunicación?",removeSolicitud:"¿Confirma que desea eliminar esta comunicación?",msgDelOrg:"¿Confirma que desea eliminar esta orgánica de la comunicación?",msgDelRuta:"¿Confirma que desea eliminar esta etapa de la comunicación?",errPerfil:"No ha seleccionado un perfil válido.",errOrganicas:"No se han encontrado orgánicas asociadas a la comunicación.",errObjeto:"Debe indicar un objeto de la actividad.",errOrigen:"¡No ha seleccionado correctamente la ciudad de origen!",errDestino:"¡No ha seleccionado correctamente la ciudad de destino!",errMinRutas:"El mínimo de trayectos a introducir es: 1 de ida y 1 de vuelta.",errFechasRuta:"¡La fecha de salida o de llegada, no es válida!",errFechaFutura:"¡Las fechas del itinerario deben ser anteriores a la fecha actual!",errFechasOrden:"¡La fecha de llegada debe ser posterior a la de salida!",errItinerario:"Error al cumplimentar los datos del itinerario.",errItinerarioCiudad:"La ciudad de origen y de destino deben de ser distintas.",errItinerarioPaises:"Los paises de origen y de destino de las etapas no son consecutivos.",errItinerarioFechas:"Las fechas de salida y de llegada de las etapas no son consecutivas.",errMulticomision:"No puede solicitar multicomisiones para esta comunicación.",errTransporte:"Medio de Transporte incorrecto.",errMatricula:"Debe indicar la matricual del vehiculo privado.",errMainRuta:"Es necesario marcar un destino del itinerario como principal.",errLinkRuta:"Debe seleccionar al menos 1 etapa.",errJustifiSubv:"Debe indicar la relación entre la actividad y el proyecto subvencionado.",errJustifiVp:"Debe justificar la razón por la que usó de su vehiculo propio.",errJustifiKm:"Debe indicar una justificación para la diferencia de kilometraje de la comunicación.",errJustifiExtra:"Debe indicar una justificación para la indemnización extraordinaria.",errEntidadOrigen:"Debe indicar una entidad de origen para la subvención.",errCongreso:"Debe justificar la fecha de inicio/fin del congreso respoecto a la del viaje.",errEstimaciones:"Debe asociar al menos una estimación a la comunicación.",errFechasAloja:"No ha seleccionadas correctamente el periodo de fechas del alojamiento.",errRangoAloja:"El periodo de fechas del gasto de alojamiento, esta fuera del rango de la solicitud.",errDoc:"Debe asociar la documentación obligatoria",errImputacion:"Error al generar la imputación asocuada a la comunicación.",errMaxDietas:"Importe máximo para dietas excedido.",errMaxAloja:"Importe máximo por alojamiento excedido.",errMaxTrans:"Importe máximo por transporte excedido.",errMaxAsist:"Importe máximo por asistencios excedido.",errImpBruto:"El importe a imputar no coincide con el bruto de la comunicación.",errTipo:"No ha seleccionado correctamente el tipo de operación.",errTipoGasto:"Debe seleccionar un tipo de gasto.",errIban:"Debe indicar un IBAN válido.",errSwift:"Debe indicar un swift válido.",errExtra:"Debe indicar un motivo para la urgencia de esta comunicación",errFechaMax:"Debe indicar una fecha maxima de resolución para esta comunicación.",tiposDesp:["","Vehículo Propio","Vehiculo de Alquiler","Vehiculo Ajeno","Taxi Interurbano","Autobús Interurbano","Tren","Barco","Avión","Otros","Transportes Públicos"],tiposEstimaciones:["-","Estimación gastos por dietas","Estimación gastos de alojamiento","Estimación gastos de transporte"],tiposMultiorganica:["-","Dietas","Alojamiento","Transporte","Asistencias"],lblPorAqui:"¡Por Aquí!",lblPaso:"Paso",lblDe:"de",lblA:"a",firstDay:"Primer día",medDay:"Días Intermedios",lastDay:"Último día"},es:{msgRechazar:"¿Confirma que desea rechazar esta comunicación?",msgUnlink:"¿Confirma que desea desasociar esta operación de la comunicación?",msgReactivar:"¿Confirma que desea reactivar esta comunicación?",msgFirmar:"¿Confirma que desea firmar esta comunicación?",msgFirmarEnviar:"¿Confirma que desea firmar y enviar esta comunicación?",removeSolicitud:"¿Confirma que desea eliminar esta comunicación?",msgDelOrg:"¿Confirma que desea eliminar esta orgánica de la comunicación?",msgDelRuta:"¿Confirma que desea eliminar esta etapa de la comunicación?",errPerfil:"No ha seleccionado un perfil válido.",errOrganicas:"No se han encontrado orgánicas asociadas a la comunicación.",errObjeto:"Debe indicar un objeto de la actividad.",errOrigen:"¡No ha seleccionado correctamente la ciudad de origen!",errDestino:"¡No ha seleccionado correctamente la ciudad de destino!",errMinRutas:"El mínimo de trayectos a introducir es: 1 de ida y 1 de vuelta.",errFechasRuta:"¡La fecha de salida o de llegada, no es válida!",errFechaFutura:"¡Las fechas del itinerario deben ser anteriores a la fecha actual!",errFechasOrden:"¡La fecha de llegada debe ser posterior a la de salida!",errItinerario:"Error al cumplimentar los datos del itinerario.",errItinerarioCiudad:"La ciudad de origen y de destino deben de ser distintas.",errItinerarioPaises:"Los paises de origen y de destino de las etapas no son consecutivos.",errItinerarioFechas:"Las fechas de salida y de llegada de las etapas no son consecutivas.",errMulticomision:"No puede solicitar multicomisiones para esta comunicación.",errTransporte:"Medio de Transporte incorrecto.",errMatricula:"Debe indicar la matricual del vehiculo privado.",errMainRuta:"Es necesario marcar un destino del itinerario como principal.",errLinkRuta:"Debe seleccionar al menos 1 etapa.",errJustifiSubv:"Debe indicar la relación entre la actividad y el proyecto subvencionado.",errJustifiVp:"Debe justificar la razón por la que usó de su vehiculo propio.",errJustifiKm:"Debe indicar una justificación para la diferencia de kilometraje de la comunicación.",errJustifiExtra:"Debe indicar una justificación para la indemnización extraordinaria.",errEntidadOrigen:"Debe indicar una entidad de origen para la subvención.",errCongreso:"Debe justificar la fecha de inicio/fin del congreso respoecto a la del viaje.",errEstimaciones:"Debe asociar al menos una estimación a la comunicación.",errFechasAloja:"No ha seleccionadas correctamente el periodo de fechas del alojamiento.",errRangoAloja:"El periodo de fechas del gasto de alojamiento, esta fuera del rango de la solicitud.",errDoc:"Debe asociar la documentación obligatoria",errImputacion:"Error al generar la imputación asocuada a la comunicación.",errMaxDietas:"Importe máximo para dietas excedido.",errMaxAloja:"Importe máximo por alojamiento excedido.",errMaxTrans:"Importe máximo por transporte excedido.",errMaxAsist:"Importe máximo por asistencios excedido.",errImpBruto:"El importe a imputar no coincide con el bruto de la comunicación.",errTipo:"No ha seleccionado correctamente el tipo de operación.",errTipoGasto:"Debe seleccionar un tipo de gasto.",errIban:"Debe indicar un IBAN válido.",errSwift:"Debe indicar un swift válido.",errExtra:"Debe indicar un motivo para la urgencia de esta comunicación",errFechaMax:"Debe indicar una fecha maxima de resolución para esta comunicación.",tiposDesp:["","Vehículo Propio","Vehiculo de Alquiler","Vehiculo Ajeno","Taxi Interurbano","Autobús Interurbano","Tren","Barco","Avión","Otros","Transportes Públicos"],tiposEstimaciones:["-","Estimación gastos por dietas","Estimación gastos de alojamiento","Estimación gastos de transporte"],tiposMultiorganica:["-","Dietas","Alojamiento","Transporte","Asistencias"],lblPorAqui:"¡Por Aquí!",lblPaso:"Paso",lblDe:"de",lblA:"a",firstDay:"Primer día",medDay:"Días Intermedios",lastDay:"Último día"}};function IrsePerfil(){const t=this,a=3,e={"A,PAS,OTR":6151,"A,PAS,xOT":4099,"A,PAS,ISU":6147,"A,PAS,xSU":4099,"A,PDI-FU,OTR":6151,"A,PDI-FU,xOT":4099,"A,PDI-FU,ISU":6147,"A,PDI-FU,xSU":4099,"A,PDI-LA,OTR":6151,"A,PDI-LA,xOT":4099,"A,PDI-LA,ISU":6147,"A,PDI-LA,xSU":4099,"A,BPE,OTR":6151,"A,BPE,xOT":4099,"A,BPE,ISU":6147,"A,BPE,xSU":4099,"A,PIN,OTR":6151,"A,PIN,xOT":4099,"A,PIN,ISU":6147,"A,PIN,xSU":4099,"A,EXT,OTR":2042,"A,EXT,xOT":1786,"A,EXT,ISU":1546,"A,EXT,xSU":1546,"A,EXT,A83":1546,"A,EXT,x83":1546,"A,EXT,ACA":1546,"A,EXT,xAC":1546,"A,ALU,OTR":1550,"A,ALU,xOT":1546,"A,ALU,ISU":1546,"A,ALU,xSU":1546,"A,ALU,A83":1546,"A,ALU,x83":1546,"A,ALU,ACA":1546,"A,ALU,xAC":1546},i={at11:45.89,at12:42.83,at13:39.78,at21:45.89,at22:42.83,at23:39.78,at31:42.83,at32:39.78,at33:36.72},n={},r={imp:i18n.isoFloat,fCache:i18n.isoDate,onFinish:(a,e)=>3==a?e:""},o={remove:"msgDelOrg",imp:i18n.isoFloat,resp:sb.lopd,fCache:i18n.isoDate};let s,m,d,c,l,u,p;var g=new Date;function f(){return d.value=function(){let e="OTR";if(0<ab.size(u)){const i="300518";if(u.forEach(a=>{e=sb.starts(a.o,i)&&8==(8&a.mask)?"ISU":e,e=sb.starts(a.o,i)&&16==(16&a.mask)&&"ISU"!=e?"A83":e,e=(sb.starts(a.o,"300906")||sb.starts(a.o,"300920"))&&"OTR"==e?"ACA":e}),1<u.length)return"ISU"==e?"xSU":"A83"==e?"x83":"ACA"==e?"xAC":"xOT"}return e}(),dom.select(c,e[s.value+","+m.innerText+","+d.value]||a).select(l,t.isCom()||t.isMov()?7:1).hide(".fin-info").show(".fin-"+d.value),t}function h(){p=null,f(),dom.setValue("#presupuesto",JSON.stringify(u))}dt.addDate(g,-1),i18n.set("fCache",g),this.isLoaded=()=>s&&m&&d&&c,this.getRol=()=>s.value,this.isColaboracion=()=>"OCE"==c.value||"IAE+OCE"==c.value,this.isTribunal=()=>"ATR"==c.value||"IAE+ATR"==c.value,this.isFormacion=()=>"AFO"==c.value||"IAE+AFO"==c.value,this.isCom=()=>"COM"==c.value,this.isMun=()=>"MUN"==c.value,this.isMes=()=>"MES"==c.value,this.isIae=()=>"IAE"==c.value,this.isAtr=()=>"ATR"==c.value,this.isAfo=()=>"AFO"==c.value,this.isAcs=()=>"ACS"==c.value,this.isCtp=()=>"CTP"==c.value,this.isOce=()=>"OCE"==c.value,this.isA7j=()=>"A7J"==c.value,this.isMov=()=>"MOV"==c.value,this.is1Dia=()=>t.isMun()||t.isMes()||t.isAcs()||t.isAfo()||t.isAtr()||t.isCtp()||t.isOce(),this.isAut=()=>"AUT"==l.value,this.isAutA7j=()=>t.isAut()||t.isA7j(),this.getTribunales=()=>i,this.getTribunal=a=>i["at"+a]||0,this.getFinanciacion=()=>d.value,this.isIsu=()=>"ISU"==d.value||"xSU"==d.value,this.isA83=()=>"A83"==d.value||"x83"==d.value,this.isACA=()=>"ACA"==d.value||"xAC"==d.value,this.isOTR=()=>"OTR"==d.value||"xOT"==d.value,this.update=f,this.getColectivo=()=>dom.getText(m),this.setColectivo=a=>(m.innerText=a,t),this.getOrganicas=()=>u,this.empty=()=>ab.empty(u),this.getNumOrganicas=()=>ab.size(u),this.isMultiorganica=()=>1<ab.size(u),this.getOrganica=e=>u.find(a=>a.id==e),this.isInve3005=a=>a&&sb.starts(a.o,"3005")&&64==(64&a.mask),this.is643=a=>a&&16==(16&a.mask),this.addOrganica=function(){p&&!u.find(a=>a.id==p.id)&&u.push(p),dom.table("#organicas",u,n,o)},this.valid=function(){return dom.closeAlerts().required("#perfil-financiacion","errPerfil"),t.empty(u)&&dom.required("#organica","errOrganicas"),dom.required("#tramitador","errPerfil").required("#interesado","errPerfil").isOk()},dom.ready(function(){function a(){i18n.set("imp",null),dom.toggleHide(".msg-cd",!this.value),fnAcReset()}s=dom.getInput("#rol"),m=dom.get("#colectivo"),d=dom.getInput("#financiacion"),c=dom.getInput("#actividad"),l=dom.getInput("#tramite"),t.isLoaded()&&($(".ac-persona:not(.ui-state-disabled)").attr("type","search").keydown(fnAcChange).autocomplete({delay:500,minLength:5,focus:fnFalse,search:fnAcSearch,source:function(a,e){fnAutocomplete(this.element,["nombre","nif"],e,a=>a.nif+" - "+a.nombre)},select:function(a,e){var i=e.item.email,a=dom.children(a.target,"a");return dom.toggleHide(a,!i).attr(a,"href","mailto:"+i),t.setColectivo(e.item.ci).update(),fnAcLoad(this,e.item.nif,e.item.nif+" - "+e.item.nombre)}}).change(fnAcReset).on("search",fnAcReset),$("#organica").attr("type","search").keydown(fnAcChange).autocomplete({delay:500,focus:fnFalse,search:fnAcSearch,source:function(a,e){fnAutocomplete(this.element,["o","dOrg"],e,a=>a.o+" - "+a.dOrg)},select:function(a,e){return p=e.item,i18n.set("imp",p.imp),fnAcLoad(this,p.id,p.o+" - "+p.dOrg),IRSE.uxxiec||(ab.reset(u).push(u,p),h()),!dom.tr(".msg-cd",r)}}).change(a).on("search",a),u=ab.parse(dom.getText("#org-data"))||[],i18n.set("imp",u[0]?.imp),dom.table("#organicas",u,n,o),dom.onRenderTable("#organicas",a=>{h(),dom.closeAlerts().toggleHide("div#add-org",u.length).clearInput("#organica")}),f(),dom.getValue("#interesado")&&dom.show(m.parentNode),dom.change(s,f).change(c,f).tr(".msg-cd",r).onChangeInput("#interesado",a=>dom.toggleHide(m.parentNode,!a.value)))})}function IrseOrganicas(){const s=this,m={imp1:0,totManutenciones:0,totPernoctas:0,totTransporte:0,totAc:0},d={remove:"msgDelOrg",imp1:i18n.isoFloat,subtipo:a=>i18n.arrval("tiposMultiorganica",a)};let c;this.getImpTransporte=function(){return m.totTransporte},this.getImpPernoctas=function(){return m.totPernoctas},this.getImpDietas=function(){return m.totManutenciones},this.getImpAc=function(){return m.totAc},this.getTotTransporte=function(){return ir.getImpKm()+IRSE.impTransporte+IRSE.impExtraTrans},this.getTotPernoctas=function(){return IRSE.minPernoctas+IRSE.impExtraAloja},this.getTotDietas=function(){return dietas.getImpPercibir()+IRSE.impExtraDietas},this.getImpBruto=()=>s.getTotTransporte()+s.getTotPernoctas()+s.getTotDietas()+IRSE.totAc,this.getImpTotal=()=>s.getImpBruto()-IRSE.irpf,this.validAll=function(){return nb.eq01(m.totManutenciones,s.getTotDietas())?nb.eq01(m.totPernoctas,s.getTotPernoctas())?nb.eq01(m.totTransporte,s.getTotTransporte())?nb.eq01(m.totAc,IRSE.totAc)?!!nb.eq01(m.imp1,s.getImpBruto())||!dom.addError("#imp1-org","errImpBruto"):!dom.addError("#imp1-org","errMaxAsist"):!dom.addError("#imp1-org","errMaxTrans"):!dom.addError("#imp1-org","errMaxAloja"):!dom.addError("#imp1-org","errMaxDietas")},this.add=function(){if(dom.closeAlerts().intval("#tipo-org","errTipo","errRequired").fk("#organicas","errOrganicas","errRequired").gt0("#imp1-org","errGt0","errRequired"),dom.isOk()){const e=i18n.toData();if("1"==e.subtipo&&e.imp1+m.totManutenciones>s.getTotDietas())return!dom.addError("#imp1-org","errMaxDietas");if("2"==e.subtipo&&e.imp1+m.totPernoctas>s.getTotPernoctas())return!dom.addError("#imp1-org","errMaxAloja");if("3"==e.subtipo&&e.imp1+m.totTransporte>s.getTotTransporte())return!dom.addError("#imp1-org","errMaxTrans");if("4"==e.subtipo&&e.imp1+m.totAc>IRSE.totAc)return!dom.addError("#imp1-org","errMaxAsist");if(e.imp1+m.imp1>IRSE.bruto)return!dom.addError("#imp1-org","errImpBruto");e.cod=dom.getOptText("#organicas");var a=ip.getOrganica(+e.num);e.nombre=ii.get(e.subtipo,a),e.desc=a&&a.dOrg,c.push(e),dom.table("#multiorganicas",c,m,d)}return!1},this.build=function(){if(ip.empty())return!dom.addError("#imp1-org","errImputacion");if(ip.isMultiorganica())return s.validAll();ab.reset(c);var a=ip.getOrganicas()[0],e={num:a.id,cod:a.o,desc:a.dOrg};let i=s.getTotDietas();if(0<i){const t=Object.assign({subtipo:1},e);t.nombre=ii.get(t.subtipo,a),t.imp1=i,c.push(t)}if(0<(i=s.getTotPernoctas())){const n=Object.assign({subtipo:2},e);n.nombre=ii.get(n.subtipo,a),n.imp1=i,c.push(n)}if(0<(i=s.getTotTransporte())){const r=Object.assign({subtipo:3},e);r.nombre=ii.get(r.subtipo,a),r.imp1=i,c.push(r)}if(0<IRSE.totAc){const o=Object.assign({subtipo:4},e);o.nombre=ii.get(o.subtipo,a),o.imp1=IRSE.totAc,c.push(o)}return dom.table("#multiorganicas",c,m,d),s.validAll()},dom.ready(function(){c=ab.parse(dom.getText("#gastos-org"))||[],dom.onRenderTable("#multiorganicas",a=>{m.imp1=0,m.totManutenciones=m.totPernoctas=0,m.totTransporte=m.totAc=0,c.forEach(a=>{m.imp1+=a.imp1,m.totManutenciones+="1"==a.subtipo?a.imp1:0,m.totPernoctas+="2"==a.subtipo?a.imp1:0,m.totTransporte+="3"==a.subtipo?a.imp1:0,m.totAc+="4"==a.subtipo?a.imp1:0}),dom.setValue("#imp-org",JSON.stringify(c)).setValue("#imp1-org","").setFocus("#tipo-org")}),dom.table("#multiorganicas",c,m,d).autofocus()})}function IrseImputacion(){const r={1:"230",2:"230",3:"231"},o={1:"30",2:"31",3:"32"},s={1:"30",2:"32",3:"31"},m={1:"33",2:"35",3:"34"},d={1:"36",2:"38",3:"37"},c={"PDI-FU":"00","PDI-LA":"01",PAS:"02",PIN:"03",BPE:"04",ALU:"05",EXT:"06"};this.get=function(a,e){if(4==a)return ip.isIsu()?ip.isColaboracion()?"642.29":ip.isTribunal()||ip.isFormacion()?"642.39.06":"-":ip.isInve3005(e)?ip.isColaboracion()?"64X.29":ip.isTribunal()||ip.isFormacion()?"64X.39.06":"-":ip.isColaboracion()?"227.15":ip.isTribunal()?"233.00.06":ip.isFormacion()?"233.01":"233.02";let i=dom.getValue("#finalidad")||"1";i=(i=(1==a?s:2==a?m:d)[i])||"XX";var t=c[ip.getColectivo()]||"XX";if(ip.isIsu())return"642."+i+"."+t;if(ip.isInve3005(e))return(ip.is643()?"643.":"64X.")+o[a]+"."+t;let n=r[a]+".xx."+t;return 1==a?n.replace("xx",ip.isMes()?"02":"00"):n.replace("xx",2==a?"01":"00")}}function IrseRutas(){const r=this;var a=37.62568269999999,e=-.9965839000000187;const i={desp:1,mask:1,lat1:a,lng1:e,pais1:"ES",lat2:a,lng2:e,pais2:"ES"},t={desp:10,mask:1,lat1:a,lng1:e,pais1:"ES",lat2:a,lng2:e,pais2:"ES"},n={desp:0,mask:0,lat:a,lng:e,pais:"ES",origen:"Cartagena, España",lat1:a,lng1:e,pais1:"ES",destino:"Cartagena, España",lat2:a,lng2:e,pais2:"ES"},o={},s={remove:"msgDelRuta",f1:(a,e)=>i18n.fmtDate(e.dt1),h1:(a,e)=>sb.minTime(e.dt1),f2:(a,e)=>i18n.fmtDate(e.dt2),h2:(a,e)=>sb.minTime(e.dt2),principal:(a,e)=>1&e.mask?'<span class="act-warn"> <i class="fal fa-flag-checkered"></i></span>':"",km1:i18n.isoFloat,km2:i18n.isoFloat,totKm:i18n.isoFloat,impKm:(a,e)=>d(e),totKm:i18n.isoFloat,totKmCalc:i18n.isoFloat,desp:a=>{let e=i18n.arrval("tiposDesp",a);return 1==a&&(e+=" ("+IRSE.matricula+")"),e}};let m;function d(a){return i18n.isoFloat(.19*a.km1)}function c(a){m.forEach(a=>{a.mask&=-2}),a.mask|=1}this.getImpKm=()=>o.impKm,this.getTotKm=()=>o.totKm,this.getTotKmCalc=()=>o.totKmCalc,this.getLoc=()=>ip.isMun()?i:t,this.getCT=()=>n,this.getAll=()=>m,this.size=()=>ab.size(m),this.empty=()=>ab.empty(m),this.first=()=>m[0],this.last=()=>ab.last(m),this.start=()=>sb.toDate(m[0]?.dt1),this.end=()=>sb.toDate(ab.last(m)?.dt2),this.isSalidaTemprana=()=>r.size()&&sb.getHours(m[0].dt1)<14,this.isSalidaTardia=()=>r.size()&&21<sb.getHours(m[0].dt1),this.isLlegadaTemprana=()=>r.size()&&sb.getHours(r.last().dt2)<14,this.isLlegadaTardia=()=>r.size()&&sb.getHours(r.last().dt2)<5,this.isLlegadaCena=()=>r.size()&&21<sb.getHours(r.last().dt2),this.getRuta=a=>{let e=dt.clone(a),i=(dt.addHours(e,29),e.toJSON()),t=r.first();return m.forEach(a=>{t=a.dt2<i?a:t}),t},this.resume=function(){return o.totKm=o.totKmCalc=0,m.forEach(a=>{o.totKm+=nb.round(a.km1||0),o.totKmCalc+=nb.round(a.km2||0)}),o.km1=o.totKm,o.impKm=.19*o.totKm,o.justifi=o.totKmCalc+.01<o.totKm,r},this.save=function(){return dom.setValue("#etapas",JSON.stringify(m)),r},this.valid=function(a){return dom.closeAlerts(),a.origen||dom.addError("#origen","errOrigen","errRequired"),1==a.desp&&dom.required("#matricula","errMatricula","errRequired"),sb.future(a.dt1)?!dom.addError("#f1","errFechaFutura"):a.dt1>a.dt2?!dom.addError("#f1","errFechasOrden"):dom.isOk()},this.validAll=function(){if(r.empty())return!dom.closeAlerts().addError("#origen","errItinerario");let e=m[0];if(!r.valid(e))return!1;for(let a=1;a<m.length;a++){var i=m[a];if(!r.valid(i))return!1;if(e.pais2!=i.pais1)return!dom.addError("#destino","errItinerarioPaises");if(e.dt2>i.dt1)return!dom.addError("#destino","errItinerarioFechas");if(m[0].origen==i.origen)return!dom.addError("#destino","errMulticomision");e=i}return dom.isOk()},this.validItinerario=function(){if(r.validAll()){let e=0;return m.forEach(a=>{e+=1&a.mask}),1==e||!dom.addError("#destino","errMainRuta")}return!1},this.add=function(a,e){a.temp=!0,m.push(a),m.sort((a,e)=>sb.cmp(a.dt1,e.dt1));let i=0,t=m[0];for(let a=1;a<m.length;a++){var n=sb.diffDate(m[a].dt1,m[a-1].dt2);i<n&&(i=n,t=m[a-1])}return r.validAll()?(delete a.temp,c(t),a.km1=a.km2=e,IRSE.matricula=dom.getValue("#matricula"),dom.table("#rutas",m,o,s)):m.remove(a=>a.temp),r},this.paso1=()=>dom.closeAlerts().required("#objeto","errObjeto","errRequired").isOk(),this.paso1Col=()=>r.paso1()&&dom.past("#fAct","errDateLe","errRequired").gt0("#impAc","errGt0","errRequired").isOk(),this.paso2=()=>r.validItinerario()&&(1<r.size()||!dom.addError("#destino","errMinRutas")),this.paso6=function(){return dom.closeAlerts(),o.justifi&&dom.required("#justifiKm","errJustifiKm","errRequired"),dom.isOk()},dom.ready(function(){if(ip.isLoaded()){if(m=ab.parse(dom.getText("#rutas-data"))||[],o.out=m.filter(a=>1!=a.desp&&3!=a.desp&&!a.g),o.sizeOut=o.out.length,o.vp=m.filter(a=>1==a.desp),o.sizeVp=o.vp.length,ip.isAutA7j()||ip.is1Dia()){const e=Object.assign({},r.getLoc(),m[0]);m[0]=e,r.resume(),dom.onChangeForm("#xeco-irse",a=>{r.resume().save()}).toggleHide(".grupo-matricula",1!=e.desp).setInput("#origen",e.origen,a=>{e.origen=e.destino=a.value}).setInput("#desp",e.desp,a=>{e.desp=+a.value}).setInput("#dist",i18n.isoFloat(e.km1),a=>{e.km1=e.km2=i18n.toFloat(a.value)}).setInput("#f2",sb.enDate(e.dt2),a=>{e.dt2=sb.endDay(a.value)}).setInput("#f1",sb.enDate(e.dt1),a=>{e.dt1=a.value,e.dt2=dom.getInput("#f2")?e.dt2:sb.endDay(e.dt1)})}else dom.onFindRow("#rutas",(a,e)=>{c(e.detail.data),dom.table("#rutas",m,o,s)}).onRenderTable("#rutas",a=>{var e=r.resume().last(m)||n;dom.table("#rutas-read",m,o,s).setValue("#origen",e.destino).setValue("#f1",sb.enDate(e.dt2)).setValue("#h1",sb.minTime(e.dt2)).setValue("#destino","").copyVal("#f2","#f1").setValue("#h2","").setValue("#principal","0").setValue("#desp","").delAttrInput("#f1","max").delAttrInput("#f2","min").hide(".grupo-matricula"),e.dt1?1&e.mask?dom.setValue("#h1","").setFocus("#h1"):dom.setFocus("#destino"):dom.setFocus("#f1")}),dom.onChangeTable("#vp",a=>{var e=o.row;const i=o.data;o.element.value=i18n.fmtFloat(o.element.value),i.km1=i18n.toFloat(o.element.value),r.resume(),dom.tfoot(a,o,s).toggleHide(".justifi-km",!o.justifi).setText(e.cells[9],d(i)+" €").setHtml("#imp-km",i18n.isoFloat(o.impKm)+" €").setHtml("#imp-bruto",i18n.isoFloat(io.getImpTotal())+" €"),o.justifi&&dom.setFocus("#justifiKm"),r.save()});dom.table("#rutas",m,o,s).onRenderTable("#rutas",r.save).table("#vp",o.vp,o,s).toggleHide(".justifi-km",!o.justifi).table("#rutas-out",o.out,o,s).onChangeInput("#f1",a=>dom.setValue("#f2",a.value)).setRangeDate("#f1","#f2").onChangeInput("#desp",a=>dom.toggleHide(".grupo-matricula","1"!=a.value)).onChangeInput("#matricula",a=>{a.value=sb.toUpperWord(a.value)})}})}function IrseDietas(){const t=this,e={ES:{a1:102.56,a2:65.97,m1:53.34,m2:37.4,max:53.34,name:"España",name_en:"Spain"},DE:{a1:155.66,a2:132.82,m1:68.52,m2:59.5,name:"Alemania",name_en:"Germany"},AD:{a1:54.69,a2:46.88,m1:44.47,m2:37.86,name:"Andorra",name_en:"Andorra"},AO:{a1:158.67,a2:135.23,m1:66.71,m2:59.5,name:"Angola",name_en:"Angola"},SA:{a1:86.55,a2:73.92,m1:60.7,m2:54.09,name:"Arabia Saudita",name_en:"Saudi Arabia"},DZ:{a1:119,a2:101.57,m1:51.09,m2:44.47,name:"Argelia",name_en:"Argelia"},AR:{a1:130.42,a2:111.19,m1:64.91,m2:55.29,name:"Argentina",name_en:"Argentina"},AU:{a1:94.96,a2:81.14,m1:657.1,m2:51.09,name:"Australia",name_en:"Australia"},AT:{a1:112.39,a2:95.56,m1:66.11,m2:58.9,name:"Austria",name_en:"Austria"},BE:{a1:174.29,a2:148.45,m1:91.35,m2:82.94,name:"Bélgica",name_en:"Belgium"},BO:{a1:60.1,a2:51.09,m1:42.67,m2:36.66,name:"Bolivia",name_en:"Bolivia"},BA:{a1:85.34,a2:72.72,m1:57.7,m2:49.88,name:"Bosnia-Herzegovina",name_en:"Bosnia-Herzegovina"},BR:{a1:150.25,a2:128.02,m1:91.35,m2:79.33,name:"Brasil",name_en:"Brazil"},BG:{a1:62.51,a2:53.49,m1:44.47,m2:37.86,name:"Bulgaria",name_en:"Bulgaria"},CM:{a1:103.37,a2:88.35,m1:91.35,m2:48.68,name:"Camerún",name_en:"Cameroon"},CA:{a1:110.59,a2:94.36,m1:58.3,m2:51.69,name:"Canadá",name_en:"Canada"},CL:{a1:120.2,a2:102.17,m1:57.7,m2:50.49,name:"Chile",name_en:"Chile"},CN:{a1:184.14,a2:71.52,m1:51.69,m2:46.28,name:"China",name_en:"China"},CO:{a1:145.44,a2:123.81,m1:90.15,m2:78.13,name:"Colombia",name_en:"Colombia"},KR:{a1:120.2,a2:102.17,m1:62.51,m2:55.29,name:"Corea del Sur",name_en:"South Korea"},CI:{a1:72.12,a2:61.3,m1:55.89,m2:49.28,name:"Costa de Marfil",name_en:"Ivory Coast"},CR:{a1:76.93,a2:65.51,m1:52.29,m2:44.47,name:"Costa Rica",name_en:"Costa Rica"},HR:{a1:85.34,a2:72.72,m1:57.7,m2:49.88,name:"Croacia",name_en:"Croatia"},CU:{a1:66.11,a2:56.5,m1:38.46,m2:33.06,name:"Cuba",name_en:"Cuba"},DK:{a1:144.24,a2:122.61,m1:72.12,m2:64.91,name:"Dinamarca",name_en:"Denmark"},DO:{a1:75.13,a2:64.31,m1:42.07,m2:36.66,name:"República Dominicana",name_en:"Dominican Republic"},EC:{a1:75.73,a2:64.91,m1:50.49,m2:43.27,name:"Ecuador",name_en:"Ecuador"},EG:{a1:106.98,a2:91.35,m1:44.47,m2:39.07,name:"Egipto",name_en:"Egypt"},SV:{a1:77.53,a2:66.11,m1:50.49,m2:43.27,name:"El Salvador",name_en:"El Salvador"},AE:{a1:119,a2:101.57,m1:63.71,m2:56.5,name:"Emiratos Árabes Unidos",name_en:"United Arab Emirates"},SK:{a1:88.95,a2:75.73,m1:49.88,m2:43.27,name:"Eslovaquia",name_en:"Slovakia"},US:{a1:168.28,a2:143.04,m1:77.53,m2:69.72,name:"Estados Unidos",name_en:"United States"},ET:{a1:140.04,a2:119.6,m1:43.87,m2:37.86,name:"Etiopía",name_en:"Ethiopia"},PH:{a1:84.14,a2:71.52,m1:45.08,m2:39.67,name:"Filipinas",name_en:"Philippines"},FI:{a1:134.63,a2:114.79,m1:72.72,m2:65.51,name:"Finlandia",name_en:"Finland"},FR:{a1:144.24,a2:122.61,m1:72.72,m2:65.51,name:"Francia",name_en:"France"},GA:{a1:117.8,a2:100.37,m1:59.5,m2:52.89,name:"Gabón",name_en:"Gabon"},GH:{a1:78.13,a2:66.71,m1:42.67,m2:37.26,name:"Ghana",name_en:"Ghana"},GR:{a1:81.14,a2:69.12,m1:45.08,m2:39.07,name:"Grecia",name_en:"Greece"},GT:{a1:105.18,a2:89.55,m1:49.28,m2:42.67,name:"Guatemala",name_en:"Guatemala"},GQ:{a1:102.77,a2:87.75,m1:56.5,m2:50.49,name:"Guinea Ecuatorial",name_en:"Equatorial Guinea"},HT:{a1:52.89,a2:45.08,m1:43.87,m2:37.86,name:"Haití",name_en:"Haití"},HN:{a1:81.74,a2:69.72,m1:49.28,m2:42.07,name:"Honduras",name_en:"Honduras"},HK:{a1:142.44,a2:121.4,m1:57.7,m2:51.69,name:"Hong-Kong",name_en:"Hong-Kong"},HU:{a1:135.23,a2:115.39,m1:52.89,m2:46.28,name:"Hungría",name_en:"Hungary"},IN:{a1:117.2,a2:99.77,m1:44.47,m2:38.46,name:"India",name_en:"India"},ID:{a1:120.2,a2:102.17,m1:48.68,m2:42.67,name:"Indonesia",name_en:"Indonesia"},IQ:{a1:77.53,a2:66.11,m1:44.47,m2:39.07,name:"Irak",name_en:"Irak"},IR:{a1:94.36,a2:80.54,m1:51.69,m2:44.47,name:"Irán",name_en:"Iran"},IE:{a1:109.38,a2:93.16,m1:54.09,m2:48.08,name:"Irlanda",name_en:"Ireland"},IL:{a1:108.78,a2:92.56,m1:63.71,m2:56.5,name:"Israel",name_en:"Israel"},IT:{a1:153.86,a2:131.02,m1:69.72,m2:63.11,name:"Italia",name_en:"Italy"},JM:{a1:90.15,a2:76.93,m1:51.69,m2:46.28,name:"Jamaica",name_en:"Jamaica"},JP:{a1:187.52,a2:159.87,m1:108.18,m2:96.76,name:"Japón",name_en:"Japan"},JO:{a1:109.38,a2:93.16,m1:48.68,m2:42.67,name:"Jordania",name_en:"Jordan"},KE:{a1:96.76,a2:82.34,m1:45.08,m2:39.67,name:"Kenia",name_en:"Kenya"},KW:{a1:144.24,a2:122.61,m1:50.49,m2:44.47,name:"Kuwait",name_en:"Kuwait"},LB:{a1:135.23,a2:115.39,m1:40.87,m2:34.86,name:"Líbano",name_en:"Lebanon"},LY:{a1:119.6,a2:102.17,m1:62.51,m2:54.69,name:"Libia",name_en:"Libya"},LU:{a1:159.27,a2:135.83,m1:63.11,m2:55.89,name:"Luxemburgo",name_en:"Luxemburgo"},MY:{a1:108.18,a2:91.95,m1:39.67,m2:34.26,name:"Malasia",name_en:"Malaysia"},MT:{a1:54.09,a2:46.28,m1:37.26,m2:31.85,name:"Malta",name_en:"Malt"},MA:{a1:116.6,a2:99.17,m1:45.68,m2:39.67,name:"Marruecos",name_en:"Morocco"},MR:{a1:57.7,a2:49.28,m1:45.08,m2:39.07,name:"Mauritania",name_en:"Mauritania"},MX:{a1:96.16,a2:81.74,m1:49.88,m2:43.27,name:"Mexico",name_en:"Mexico"},MZ:{a1:78.73,a2:67.31,m1:48.08,m2:42.67,name:"Mozambique",name_en:"Mozambique"},NI:{a1:110.59,a2:94.36,m1:61.9,m2:52.89,name:"Nicaragua",name_en:"Nicaragua"},NG:{a1:138.23,a2:117.8,m1:51.69,m2:46.88,name:"Nigeria",name_en:"Nigeria"},NO:{a1:156.26,a2:132.82,m1:89.55,m2:80.54,name:"Noruega",name_en:"Norway"},NZ:{a1:76.93,a2:65.51,m1:46.28,m2:40.27,name:"Nueva Zelanda",name_en:"New Zealand"},NL:{a1:149.05,a2:126.81,m1:71.52,m2:64.31,name:"Países Bajos",name_en:"Netherlands"},PK:{a1:68.52,a2:58.3,m1:43.27,m2:37.26,name:"Pakistán",name_en:"Pakistán"},PA:{a1:75.73,a2:64.91,m1:42.07,m2:36.66,name:"Panamá",name_en:"Panama"},PY:{a1:53.49,a2:45.68,m1:38.46,m2:33.06,name:"Paraguay",name_en:"Paraguay"},PE:{a1:93.76,a2:79.93,m1:50.49,m2:43.27,name:"Perú",name_en:"Peru"},PL:{a1:117.2,a2:99.77,m1:48.68,m2:42.67,name:"Polonia",name_en:"Poland"},PT:{a1:114.19,a2:97.36,m1:51.09,m2:43.87,name:"Portugal",name_en:"Portugal"},UK:{a1:183.91,a2:156.86,m1:91.35,m2:82.94,name:"Reino Unido",name_en:"United Kingdom"},GB:{a1:183.91,a2:156.86,m1:91.35,m2:82.94,name:"Reino Unido",name_en:"United Kingdom"},CZ:{a1:119,a2:101.57,m1:49.88,m2:43.27,name:"República Checa",name_en:"Czech Republic"},RO:{a1:149.05,a2:126.81,m1:44.47,m2:38.46,name:"Rumanía",name_en:"Romania"},RU:{a1:267.45,a2:227.78,m1:83.54,m2:73.32,name:"Rusia",name_en:"Russia"},SN:{a1:79.33,a2:67.91,m1:51.09,m2:45.08,name:"Senegal",name_en:"Senegal"},CS:{a1:115.39,a2:98.57,m1:57.7,m2:49.88,name:"Serbia y Montenegro",name_en:"Serbia and montenegro"},SG:{a1:99.77,a2:85.34,m1:54.09,m2:48.08,name:"Singapur",name_en:"Singapore"},SY:{a1:97.96,a2:83.54,m1:52.29,m2:46.28,name:"Siria",name_en:"Syria"},ZA:{a1:75.13,a2:64.31,m1:55.89,m2:48.08,name:"Sudáfrica",name_en:"South Africa"},SE:{a1:173.09,a2:147.25,m1:82.34,m2:75.13,name:"Suecia",name_en:"Sweden"},CH:{a1:174.29,a2:148.45,m1:69.12,m2:61.3,name:"Suiza",name_en:"Swiss"},TH:{a1:81.14,a2:69.12,m1:45.08,m2:39.07,name:"Tailandia",name_en:"Tailandia"},TW:{a1:96.16,a2:81.74,m1:54.09,m2:48.68,name:"Taiwan",name_en:"Taiwan"},TZ:{a1:90.15,a2:76.93,m1:34.86,m2:30.05,name:"Tanzania",name_en:"Tanzania"},TN:{a1:60.7,a2:51.69,m1:54.09,m2:46.28,name:"Túnez",name_en:"Tunisia"},TR:{a1:72.12,a2:61.3,m1:45.08,m2:39.07,name:"Turquía",name_en:"Turkey"},UY:{a1:67.31,a2:57.7,m1:48.68,m2:41.47,name:"Uruguay",name_en:"Uruguay"},VE:{a1:91.35,a2:78.13,m1:42.07,m2:36.06,name:"Venezuela",name_en:"Venezuela"},YE:{a1:156.26,a2:132.82,m1:49.28,m2:43.27,name:"Yemen",name_en:"Yemen"},ZR:{a1:119,a2:101.57,m1:60.7,m2:54.09,name:"Zaire / Congo",name_en:"Zaire / Congo"},ZW:{a1:90.15,a2:76.93,m1:45.08,m2:39.07,name:"Zimbabwe",name_en:"Zimbabwe"},ZZ:{a1:127.41,a2:108.78,m1:46.88,m2:40.87,max:91.35,name:"Resto del Mundo",name_en:"Rest of the world"}},n={dias:0,impMax:0,reducido:0,percibir:0},r={cod:a=>i18n.val(t.getDieta(a),"name"),f1:i18n.fmtDate,f2:i18n.fmtDate,imp1:i18n.isoFloat1,imp2:i18n.isoFloat,impMax:i18n.isoFloat,maxDietas:i18n.isoFloat1,reducido:i18n.isoFloat,percibir:i18n.isoFloat,dietas:(a,e,i)=>{let t="";for(let a=0;a<=e.maxDietas;a+=.5)t+='<option value="'+a+(e.imp1==a?'" selected>':'">')+i18n.isoFloat1(a)+"</option>";return t}};let i;this.getDieta=a=>e[a]||e.ZZ,this.getPais=a=>i18n.val(t.getDieta(a),"name"),this.getA1=a=>t.getDieta(a).a1,this.getA2=a=>t.getDieta(a).a2,this.getImpAlojamiento=a=>"1"==i?t.getA1(a):t.getA2(a),this.getM1=a=>t.getDieta(a).m1,this.getM2=a=>t.getDieta(a).m2,this.getImpDieta=a=>"1"==i?t.getM1(a):t.getM2(a),this.getImpDietaMax=a=>t.getDieta(a).max||e.ZZ.max,this.getImporte=function(a,e){var i=16&IRSE.mask;return"1"==e?i?Math.max(t.getImpDietaMax(a),t.getImpDieta(a)):t.getImpDieta(a):"2"==e?i?Math.max(t.getImpDietaMax(a),t.getImpAlojamiento(a)):t.getImpAlojamiento(a):null},this.getImpMax=()=>n.impMax,this.getImpReducido=()=>n.reducido,this.getImpPercibir=()=>n.percibir,dom.ready(function(){i=dom.getValue("#dieta")||"2";const t=ab.parse(dom.getText("#dietas-data"))||[];dom.onChangeTable("#manutenciones",a=>{var e=n.row;const i=n.data;i.imp1=+n.element.value,dom.tfoot(a,n,r).setText(e.cells[9],i18n.isoFloat(i.reducido)+" €").setText(e.cells[10],i18n.isoFloat(i.percibir)+" €").setHtml("#imp-dietas",i18n.isoFloat(n.percibir)+" €").setHtml("#imp-bruto",i18n.isoFloat(io.getImpTotal())+" €").setValue("#gastos-dietas",JSON.stringify(t))}).onRenderTable("#manutenciones",a=>{var i=ab.size(t);if(0!=i){let a=t[0];if(a.maxDietas=a.estado/2,a.impMax=a.imp2*a.maxDietas,1==a.maxDietas?a.reducido=(1-a.imp1)*a.imp2:a.reducido=a.imp1?0:a.impMax,a.percibir=a.impMax-a.reducido,a.periodo=i18n.get("firstDay"),n.dias=1,n.impMax=a.impMax,n.reducido=a.reducido,n.percibir=a.percibir,1!=i){i--;for(let e=1;e<i;e++){let a=t[e];a.periodo=i18n.get("medDay"),a.impMax=a.num*a.imp2,a.reducido=(a.num-a.imp1)*a.imp2,a.percibir=a.impMax-a.reducido,a.maxDietas=a.num,n.dias+=a.num,n.impMax+=a.impMax,n.reducido+=a.reducido,n.percibir+=a.percibir}if(0<i){let a=ab.last(t);a.maxDietas=a.estado/2,a.impMax=a.imp2*a.maxDietas,a.reducido=a.imp1?0:a.impMax,a.percibir=a.impMax-a.reducido,a.periodo=i18n.get("lastDay"),n.dias++,n.impMax+=a.impMax,n.reducido+=a.reducido,n.percibir+=a.percibir}}}}),dom.table("#manutenciones",t,n,r).setHtml("#imp-dietas",i18n.isoFloat(n.percibir)+" €").setHtml("#imp-bruto",i18n.isoFloat(io.getImpTotal())+" €")})}dom.ready(function(){i18n.addLangs(IRSE_I18N).setCurrent(IRSE.lang),dom.tr(".i18n-tr-h1")});const ip=new IrsePerfil,io=new IrseOrganicas,ii=new IrseImputacion,ir=new IrseRutas,dietas=new IrseDietas,fnUnlink=()=>i18n.confirm("msgUnlink")&&loading(),fnClone=()=>i18n.confirm("msgReactivar")&&loading();