const loadDelegacion=(e,o)=>dom.setValue("#del-id",e).setValue("#del-name",o),loadDelegaciones=(e,o,c)=>{const n=ab.parse(c.data);n&&(dom.setHtml("#delegacion",n.format('<option value="@value;">@label;</option>')),loadDelegacion(n[0].value,n[0].label)),unloading()};dom.ready(function(){const c={imp:0,iva:0},o={imp:i18n.isoFloat,fUxxi:i18n.fmtDate},n={msgError:"errForm",factura:{msgError:"errForm",tercero:i18n.required,"id-tercero":i18n.required,delegacion:i18n.required,organica:i18n.required,"id-organica":i18n.required,memoria:i18n.required},lineas:{msgError:"errForm",desc:i18n.required,imp:i18n.gt0}};let a="cp";function e(e,o,c,n,a,s){dom.setValue("#economica",e).setValue("#sujeto",o).setValue("#exento",c).setValue("#m349",n).setValue("#iban",a).val("#iva",s||0).toggleHide(".grupo-exento",0!=o)}const L=()=>e(null,0,0,0);var s=()=>e("323003",0,1,0),i=()=>e("323003",1,0,6),t=()=>e("131004",0,1,0,10),u=()=>e("131004",1,0,6,10),r=()=>e("131004",1,0,0,10),l=()=>e("131200",0,1,0,10),d=()=>e("131200",1,0,6,10),p=()=>e("139000",0,0,0,10,21),z=()=>e("139000",1,0,6,10),m=()=>e("139001",0,0,0,10,21),g=()=>e("139001",1,0,6,10),f=()=>e("139002",0,0,0,10,21),v=()=>e("139002",1,0,6,10),b=()=>e("131600",0,0,0,10,21),h=()=>e("131600",1,0,6,10),q=()=>e("131600",1,0,0,10),x=()=>e("131600",0,5,2,10),V=()=>e("131600",0,2,0,10),F=()=>e("132500",0,0,0,4,21),E=()=>e("132500",1,0,6,4,21),T=()=>e("132700",0,0,0,10,21),C=()=>e("132700",1,0,6,10),D=()=>e("132700",1,0,0,10),S=()=>e("132600",0,0,0,10,4),y=()=>e("133001",0,0,0,10,4),A=()=>e("133001",0,5,2,10),H=()=>e("133001",0,2,0,10),M=()=>e("133001",1,0,6,10),O=()=>e("133001",1,0,0,10),w=()=>e("154000",0,0,0,10,21),I=()=>e("155100",0,0,0,4,21),R=()=>e("155100",1,0,6,4);const J={cp13:()=>e(null,0,0,0,10),c1epes4:s,c1noes4:s,c1noue4:s,c1nozz4:s,c2epes4:s,c2noes4:s,c2noue4:i,c2nozz4:s,c3epes4:s,c3noes4:s,c3noue4:i,c3nozz4:s,c2epes14:t,c2noes14:t,c2noue14:u,c2nozz14:r,c3epes14:t,c3noes14:t,c3noue14:u,c3nozz14:r,c1epes3:s,c1noes3:s,c1noue3:s,c1nozz3:s,c2epes3:s,c2noes3:s,c2noue3:i,c2nozz3:s,c3epes3:s,c3noes3:s,c3noue3:i,c3nozz3:s,c2epes15:l,c2noes15:l,c2noue15:d,c2nozz15:l,c3epes15:l,c3noes15:l,c3noue15:d,c3nozz15:l,c1epes9:s,c1noes9:s,c1noue9:s,c1nozz9:s,c2epes9:s,c2noes9:s,c2noue9:i,c2nozz9:s,c3epes9:s,c3noes9:s,c3noue9:i,c3nozz9:s,c2epes16:p,c2noes16:p,c2noue16:z,c2nozz16:p,c3epes16:p,c3noes16:p,c3noue16:z,c3nozz16:p,c2epes17:m,c2noes17:m,c2noue17:g,c2nozz17:m,c3epes17:m,c3noes17:m,c3noue17:g,c3nozz17:m,c2epes18:f,c2noes18:f,c2noue18:v,c2nozz18:f,c3epes18:f,c3noes18:f,c3noue18:v,c3nozz18:f,c1epes5:b,c1noes5:b,c1noue5:b,c1nozz5:b,c2epes5:b,c2noes5:b,c2noue5:h,c2nozz5:q,c3epes5:b,c3noes5:b,c3noue5:h,c3nozz5:q,c1epes19:b,c1noes19:b,c1noue19:b,c1nozz19:b,c2epes19:b,c2noes19:b,c2noue19:x,c2nozz19:V,c3epes19:b,c3noes19:b,c3noue19:x,c3nozz19:V,c1epes1:F,c1noes1:F,c1noue1:F,c1nozz1:F,c2epes1:F,c2noes1:F,c2noue1:E,c2nozz1:F,c3epes1:F,c3noes1:F,c3noue1:E,c3nozz1:F,c1epes20:T,c1noes20:T,c1noue20:T,c1nozz20:T,c2epes20:T,c2noes20:T,c2noue20:C,c2nozz20:D,c3epes20:T,c3noes20:T,c3noue20:C,c3nozz20:D,c2epes21:S,c2noes21:S,c3epes21:S,c3noes21:S,c1epes22:y,c1noes22:y,c1noue22:y,c1nozz22:y,c2epes22:y,c2noes22:y,c2noue22:A,c2nozz22:H,c3epes22:y,c3noes22:y,c3noue22:A,c3nozz22:H,c1epes23:y,c1noes23:y,c1noue23:y,c1nozz23:y,c2epes23:y,c2noes23:y,c2noue23:M,c2nozz23:O,c3epes23:y,c3noes23:y,c3noue23:M,c3nozz23:O,c1epes6:w,c1noes6:w,c1noue6:w,c1nozz6:w,c2epes6:w,c2noes6:w,c2noue6:w,c2nozz6:w,c3epes6:w,c3noes6:w,c3noue6:w,c3nozz6:w,c2epes2:I,c2noes2:I,c2noue2:R,c2nozz2:I,c3epes2:I,c3noes2:I,c3noue2:R,c3nozz2:I},N=e=>dom.toggleHide("#grupo-recibo",9!=e&&4!=e&&3!=e),j=e=>{N(e);const o=J[a+e]||L;o()};t=dom.getValue("#subtipo");(FACT.id?N:j)(t);const k=ab.parse(dom.getText("#lineas-json"))||[],U=(e,o)=>{c.iva=+o;o=c.imp*(c.iva/100);dom.setText(e.cells[1],i18n.isoFloat(o)+" €").setText(e.nextElementSibling.cells[1],i18n.isoFloat(c.imp+o)+" €")};function B(){this.value||(dom.setHtml("#delegacion",'<option value="">Seleccione una delegación</option>'),loadDelegacion("","Seleccione una delegación"),fnAcLoad(this,"",""))}c.iva=+dom.getValue("#iva")??0,n.factura.economica=FACT.uae?i18n.required:null,dom.click("a#add-linea",e=>{dom.validate("#xeco-fact",n.lineas)&&(k.push(i18n.toData()),dom.table("#conceptos",k,c,o)),dom.setValue("#linea","").setValue("#imp","").setFocus("#linea")}),dom.onRenderTable("#conceptos",e=>{c.imp=0,k.forEach(e=>{c.imp+=e.imp}),dom.setValue("#lineas",JSON.stringify(k))}),dom.afterRenderTable("#conceptos",e=>{e.tFoot.querySelector("#iva").value=c.iva,U(e.tFoot.rows[1],c.iva)}),dom.table("#conceptos",k,c,o).onChangeTable("#conceptos",e=>U(c.row,c.element.value)),dom.swapAttr("#fMax","min","max").onChangeInput("#subtipo",e=>j(e.value)).onChangeInput("#delegacion",e=>loadDelegacion(e.value,dom.getOptText(e))).onChangeInput("#sujeto",e=>dom.toggleHide(".grupo-exento",0!=e.value)).onChangeInputs(".face-common",o=>dom.eachInput(".face-common",e=>{e.value=o.value})),dom.onChangeSelect("#face",e=>{n.factura.og=1==e.value?i18n.required:null,n.factura.plataforma=2==e.value?i18n.required:null,dom.toggleHide("div.grupo-face",1!=e.value).toggleHide("div.grupo-face-otras",2!=e.value)}),window.fnSend=()=>{if(!dom.validate("#xeco-fact",n.factura))return null;var e=i18n.toData();return ab.size(k)||dom.required("#linea","Debe detallar los conceptos asociados a la solicitud."),3!=e.subtipo&&9!=e.subtipo||e.refreb||dom.addError("#recibo","Debe indicar un número de recibo válido"),10==e.subtipo&&dom.required("#extra",n.msgError).leToday("#fMax",n.msgError),1==e.face&&dom.required("#og",n.msgError).required("#oc",n.msgError).required("#ut",n.msgError),2==e.face&&dom.required("#plataforma",n.msgError),e},$(".ac-tercero").attr("type","search").keydown(fnAcChange).autocomplete({delay:500,minLength:5,focus:fnFalse,search:fnAcSearch,source:fnSourceItems,select:function(e,o){var c;return loading(),1==FACT.tipo?(a="c"+o.item.imp,a+=256&o.item.int?"ep":"no",c=128&o.item.int||256&o.item.int,a+=c?2048&o.item.int?"es":"np":2&o.item.int?"ue":"zz"):a="cp",j(dom.getValue("#subtipo")),!dom.setValue("#tercero",o.item.label).setValue("#id-tercero",o.item.value).trigger("#find-delegaciones","click")}}).change(B).on("search",B)});