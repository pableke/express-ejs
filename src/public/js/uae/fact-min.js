const loadDelegaciones=(e,o,t)=>{const a=ab.parse(t.data);a&&dom.setHtml("#id-delegacion",a.format('<option value="@value;">@label;</option>')).setValue("#delegacion",a[0].value),unloading()};dom.ready(function(){const t={imp:0,iva:0},a={imp:i18n.isoFloat,fUxxi:i18n.fmtDate},n={msgError:"errForm",factura:{msgError:"errForm",tercero:i18n.required,delegacion:i18n.required,organica:i18n.required,economica:i18n.digits,memoria:i18n.required},lineas:{msgError:"errForm",linea:i18n.required,imp:i18n.gt0}},i=ab.parse(dom.getText("#lineas-json"))||[],r=(e,o)=>{t.iva=+o;o=t.imp*(t.iva/100);dom.setText(e.cells[1],i18n.isoFloat(o)+" €").setText(e.nextElementSibling.cells[1],i18n.isoFloat(t.imp+o)+" €")};function e(){this.value||(dom.setHtml("#id-delegacion",'<option value="">Seleccione una delegación</option>').setValue("#delegacion"),fnAcLoad(this,"",""))}dom.click("a#add-linea",e=>{var o=dom.validate("#xeco-fact",n.lineas);o&&(i.push(o),dom.table("#conceptos",i,t,a)),dom.setValue("#linea","").setValue("#imp","").setFocus("#linea")}),dom.table("#conceptos",i,t,a).onChangeTable("#conceptos",e=>r(t.row,t.element.value)),dom.onRenderTable("#conceptos",e=>{t.imp=0,i.forEach(e=>{t.imp+=e.imp}),dom.setValue("#lineas",JSON.stringify(i))}),dom.afterRenderTable("#conceptos",e=>{const o=e.tFoot.querySelector("#iva");o&&(o.value=t.iva,r(e.tFoot.rows[1],t.iva))}),dom.swapAttr("#fMax","min","max").onChangeSelect("#delegacion",e=>dom.setValue("#id-delegacion",e.value)).onChangeSelect("#sujeto",e=>dom.toggleHide(".grupo-exento",0!=e.value)),dom.onChangeSelect("#face",e=>{dom.toggleHide("div.grupo-face",1!=e.value).toggleHide("div.grupo-face-otras",2!=e.value)}),dom.onChangeSelect("#subtipo",e=>{dom.toggleHide("#grupo-recibo",9!=e.value&&3!=e.value).toggleHide(".grupo-deportes",10!=e.value)}),window.fnSend=()=>{var e=dom.validate("#xeco-fact",n.factura);return e&&(ab.size(i)||dom.required("#linea","Debe detallar los conceptos asociados a la solicitud."),3!=e.subtipo&&9!=e.subtipo||e.refreb||dom.addError("#recibo","Debe indicar un número de recibo válido"),10==e.subtipo&&dom.required("#extra",n.msgError).leToday("#fMax",n.msgError),1==e.face&&dom.required("#og",n.msgError).required("#oc",n.msgError).required("#ut",n.msgError),2==e.face&&dom.required("#plataforma",n.msgError)),e},$(".ac-tercero").attr("type","search").keydown(fnAcChange).autocomplete({delay:500,minLength:5,focus:fnFalse,search:fnAcSearch,source:function(e,o){fnAutocomplete(this.element,["nombre","nif"],o,e=>e.nif+" - "+e.nombre)},select:function(e,o){return loading(),!dom.setValue("#tercero",o.item.nif+" - "+o.item.nombre).setValue("#nif-tercero",o.item.nif).setValue("#id-tercero",o.item.id).trigger("#find-delegaciones","click")}}).change(e).on("search",e),$(".ac-organica").attr("type","search").keydown(fnAcChange).autocomplete({delay:500,focus:fnFalse,search:fnAcSearch,source:function(e,o){fnAutocomplete(this.element,["o","dOrg"],o,e=>e.o+" - "+e.dOrg)},select:function(e,o){return fnAcLoad(this,o.item.id,o.item.o+" - "+o.item.dOrg)}}).change(fnAcReset).on("search",fnAcReset),$(".ac-recibo").attr("type","search").keydown(fnAcChange).autocomplete({delay:500,focus:fnFalse,search:fnAcSearch,source:function(e,o){fnAutocomplete(this.element,["label"],o,e=>e.label)},select:function(e,o){return fnAcLoad(this,o.item.value,o.item.label)}}).change(fnAcReset).on("search",fnAcReset);let c,o;$("#uxxi").attr("type","search").keydown(fnAcChange).autocomplete({delay:500,minLength:3,focus:fnFalse,search:fnAcSearch,source:function(e,o){fnAutocomplete(this.element,["num","desc"],o,e=>e.num+" - "+e.uxxi+"<br>"+e.desc)},select:function(e,o){c=o.item;var t=o.item.num+" - "+o.item.desc;return fnAcLoad(this,o.item.ec+","+o.item.tipo,t)}}).change(fnAcReset).on("search",fnAcReset),o=ab.parse(dom.getText("#op-json"))||[],dom.click("a#add-uxxi",e=>{c&&(delete c.id,o.push(c),dom.table("#op-table",o,t,a)),dom.setValue("#uxxi","").setFocus("#uxxi")}),dom.table("#op-table",o,t,a),dom.onRenderTable("#op-table",e=>{dom.setValue("#operaciones",JSON.stringify(o)),c=null})});