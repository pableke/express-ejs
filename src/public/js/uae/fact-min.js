const loadDelegacion=(e,o)=>dom.setValue("#del-id",e).setValue("#del-name",o),loadDelegaciones=(e,o,n)=>{const c=ab.parse(n.data);c&&(dom.setHtml("#delegacion",c.format('<option value="@value;">@label;</option>')),loadDelegacion(c[0].value,c[0].label)),unloading()};dom.ready(function(){const n={imp:0,iva:0},o={imp:i18n.isoFloat,fUxxi:i18n.fmtDate},c={msgError:"errForm",factura:{msgError:"errForm",tercero:i18n.required,"id-tercero":i18n.required,delegacion:i18n.required,organica:i18n.required,"id-organica":i18n.required,memoria:i18n.required},lineas:{msgError:"errForm",desc:i18n.required,imp:i18n.gt0}};let a;function e(e,o,n,c,a,i){dom.setValue("#economica",e).setValue("#sujeto",o).setValue("#exento",n).setValue("#m349",c).setValue("#iban",a).val("#iva",i||0).toggleHide(".grupo-exento",0!=o)}const i=()=>e(null,0,0,0);var t=()=>e("323003",0,1,0),r=()=>e("323003",1,0,0),l=()=>e("131004",0,1,0,10),s=()=>e("131004",1,0,6,10),u=()=>e("131004",1,0,0,10),d=()=>e("323003",0,1,0),m=()=>e("323003",1,0,0,6),p=()=>e("131200",0,1,0,10),g=()=>e("131200",1,0,6,10),z=()=>e("323003",0,1,0),f=()=>e("323003",1,0,6),v=()=>e("139000",0,0,0,10,21),b=()=>e("139000",1,0,6,10),h=()=>e("139001",0,0,0,10,21),q=()=>e("139001",1,0,6,10),x=()=>e("139002",0,0,0,10,21),V=()=>e("139002",1,0,6,10);const E={c1epes4:t,c1noes4:t,c1noue4:t,c1nozz4:t,c2epes4:t,c2noes4:t,c2noue4:r,c2nozz4:t,c3epes4:t,c3noes4:t,c3noue4:r,c3nozz4:t,c2epes14:l,c2noes14:l,c2noue14:s,c2nozz14:u,c3epes14:l,c3noes14:l,c3noue14:s,c3nozz14:u,c1epes3:d,c1noes3:d,c1noue3:d,c1nozz3:d,c2epes3:d,c2noes3:d,c2noue3:m,c2nozz3:d,c3epes3:d,c3noes3:d,c3noue3:m,c3nozz3:d,c2epes15:p,c2noes15:p,c2noue15:g,c2nozz15:p,c3epes15:p,c3noes15:p,c3noue15:g,c3nozz15:p,c1epes9:z,c1noes9:z,c1noue9:z,c1nozz9:z,c2epes9:z,c2noes9:z,c2noue9:f,c2nozz9:z,c3epes9:z,c3noes9:z,c3noue9:f,c3nozz9:z,c2epes16:v,c2noes16:v,c2noue16:b,c2nozz16:v,c3epes16:v,c3noes16:v,c3noue16:b,c3nozz16:v,c2epes17:h,c2noes17:h,c2noue17:q,c2nozz17:h,c3epes17:h,c3noes17:h,c3noue17:q,c3nozz17:h,c2epes18:x,c2noes18:x,c2noue18:V,c2nozz18:x,c3epes18:x,c3noes18:x,c3noue18:V,c3nozz18:x},F=e=>{dom.toggleHide("#grupo-recibo",9!=e&&4!=e&&3!=e);const o=E[a+e]||i;console.log("ECONOMICAS",a+e,o),o()},C=(F(dom.getValue("#subtipo")),ab.parse(dom.getText("#lineas-json"))||[]),D=(e,o)=>{n.iva=+o;o=n.imp*(n.iva/100);dom.setText(e.cells[1],i18n.isoFloat(o)+" €").setText(e.nextElementSibling.cells[1],i18n.isoFloat(n.imp+o)+" €")};function S(){this.value||(dom.setHtml("#delegacion",'<option value="">Seleccione una delegación</option>'),loadDelegacion("","Seleccione una delegación"),fnAcLoad(this,"",""))}n.iva=+dom.getValue("#iva")??0,c.factura.economica=FACT.uae?i18n.required:null,dom.click("a#add-linea",e=>{dom.validate("#xeco-fact",c.lineas)&&(C.push(i18n.toData()),dom.table("#conceptos",C,n,o)),dom.setValue("#linea","").setValue("#imp","").setFocus("#linea")}),dom.onRenderTable("#conceptos",e=>{n.imp=0,C.forEach(e=>{n.imp+=e.imp}),dom.setValue("#lineas",JSON.stringify(C))}),dom.afterRenderTable("#conceptos",e=>{e.tFoot.querySelector("#iva").value=n.iva,D(e.tFoot.rows[1],n.iva)}),dom.table("#conceptos",C,n,o).onChangeTable("#conceptos",e=>D(n.row,n.element.value)),dom.swapAttr("#fMax","min","max").onChangeInput("#subtipo",e=>F(e.value)).onChangeInput("#delegacion",e=>loadDelegacion(e.value,dom.getOptText(e))).onChangeInput("#sujeto",e=>dom.toggleHide(".grupo-exento",0!=e.value)).onChangeInputs(".face-common",o=>dom.eachInput(".face-common",e=>{e.value=o.value})),dom.onChangeSelect("#face",e=>{c.factura.og=1==e.value?i18n.required:null,c.factura.plataforma=2==e.value?i18n.required:null,dom.toggleHide("div.grupo-face",1!=e.value).toggleHide("div.grupo-face-otras",2!=e.value)}),window.fnSend=()=>{if(!dom.validate("#xeco-fact",c.factura))return null;var e=i18n.toData();return ab.size(C)||dom.required("#linea","Debe detallar los conceptos asociados a la solicitud."),3!=e.subtipo&&9!=e.subtipo||e.refreb||dom.addError("#recibo","Debe indicar un número de recibo válido"),10==e.subtipo&&dom.required("#extra",c.msgError).leToday("#fMax",c.msgError),1==e.face&&dom.required("#og",c.msgError).required("#oc",c.msgError).required("#ut",c.msgError),2==e.face&&dom.required("#plataforma",c.msgError),e},$(".ac-tercero").attr("type","search").keydown(fnAcChange).autocomplete({delay:500,minLength:5,focus:fnFalse,search:fnAcSearch,source:fnSourceItems,select:function(e,o){loading(),a="c"+o.item.imp,a+=256&o.item.int?"ep":"no";var n=128&o.item.int||256&o.item.int;return a+=n?2048&o.item.int?"es":"np":2&o.item.int?"ue":"zz",F(dom.getValue("#subtipo")),!dom.setValue("#tercero",o.item.label).setValue("#id-tercero",o.item.value).trigger("#find-delegaciones","click")}}).change(S).on("search",S)});