dom.ready(function(){const t={imp:0},n={empty:"N/A",imp:i18n.isoFloat,gg:i18n.isoFloat,ing:i18n.isoFloat,ch:i18n.isoFloat,mh:i18n.isoFloat,ih:i18n.isoFloat,fUxxi:i18n.fmtDate,fa:(e,a)=>i18n.fmtBool(1&a.omask),info:(e,a)=>{let i="";return(5==PRESTO.tipo||"642"==a.e)&&sb.isset(a.ih)&&a.ih+.01<a.imp&&(i='<span class="textwarn textbig" title="La cantidad solicitada excede el margen registrado por el Buzón de Ingresos">&#9888;</span>',a.mask|=2),4&a.mask&&(i+='<span class="textbig" title="Este contrato ha gozado de anticipo en algún momento">&#65;</span>'),i}},o={msgError:"errForm",presto:{"org-dec":i18n.required,"org-dec-id":i18n.required,"eco-dec":i18n.required},partidas:{"org-inc":i18n.required,"org-inc-id":i18n.required,"eco-inc":i18n.required,"imp-inc":i18n.gt0}},e="Seleccione una económica",a='<option value="">'+e+"</option>",d='<option value="@value;">@label;</option>';let c,r,l,s=ab.parse(dom.getText("#partidas-json"))||[];const i=e=>e.label,m=(e,a,i)=>dom.setValue("#org-dec",i).setValue("#org-dec-id",e).setValue("#fa-dec",i18n.fmtBool(1&a)),u=(e,a,i)=>dom.setValue("#eco-value",e).setValue("#eco-label",a).setValue("#imp-cd",i18n.isoFloat(i)),p=e=>{1&e&&-1<[1,6].indexOf(PRESTO.tipo)&&dom.showInfo("La orgánica seleccionada es afectada, por lo que su solicitud solo se aceptará para determinado tipo de operaciones.")},g=e=>{s[0].imp=i18n.toFloat(e)||0,dom.table("#partidas-tb",s,t,n)},f=(e,a)=>{e=ab.parse(e);e?(s=[e],g()):dom.showError(a),unloading()};function h(){8!=PRESTO.tipo&&PRESTO.autoloadInc&&dom.clearTable("#partidas-tb",s,t,n),u("",e).setHtml("#eco-dec",a),m()}function b(){this.value||h()}window.loadEconomicasDec=(e,a,i)=>{unloading(),c=ab.parse(i.data),(l=c&&c[0])?(u(l.value,l.label,l.imp).setHtml("#eco-dec",c.format(d)),3==PRESTO.tipo?dom.loading().trigger("#find-aip","click"):5==PRESTO.tipo&&dom.loading().trigger("#find-ant","click")):dom.showError("Aplicación no encontrada en el sistema.")},window.loadAip=(e,a,i)=>f(i.data,"Aplicación AIP no encontrada en el sistema."),window.loadAnt=(e,a,i)=>f(i.data,"No se ha encontrado el anticipo en el sistema."),$("#org-dec").attr("type","search").keydown(fnAcChange).autocomplete({delay:500,minLength:4,focus:fnFalse,search:fnAcSearch,source:fnSourceItems,select:function(e,a){return loading(),p(a.item.int),m(a.item.value,a.item.int,i(a.item)),!dom.trigger("#find-economicas-dec","click")}}).change(b).on("search",b),dom.onChangeInput("#imp-dec",e=>{PRESTO.autoloadInc&&s.length&&g(e.value)});const v=(e,a,i)=>dom.setValue("#org-inc",i).setValue("#org-inc-id",e).setValue("#fa-inc",i18n.fmtBool(1&a)),I=(e,a)=>dom.setValue("#eco-inc-value",e).setValue("#eco-inc-label",a);function w(){v(),I("",e).setHtml("#eco-inc",a).setValue("#imp-inc")}function x(){this.value||w()}window.loadEconomicasInc=(e,a,i)=>{i=(r=ab.parse(i.data))&&r[0];i&&I(i.value,i.label).setHtml("#eco-inc",r.format(d)),unloading()},$("#org-inc").attr("type","search").keydown(fnAcChange).autocomplete({delay:500,minLength:4,focus:fnFalse,search:fnAcSearch,source:fnSourceItems,select:function(e,a){return loading(),p(a.item.int),v(a.item.value,a.item.int,i(a.item)),!dom.trigger("#find-economicas-inc","click")}}).change(x).on("search",x),dom.onChangeInput("#ej-dec",e=>{dom.setValue("#ej-inc",e.value),h()}).onChangeInput("#ej-inc",w).eachInput(".ui-float",e=>{e.value=i18n.isoFmt(e.value)}),dom.onChangeInput("#eco-dec",e=>{l=c[e.selectedIndex],u(e.value,dom.getOptText(e),l.imp)}),dom.onChangeInput("#eco-inc",e=>{inc=r[e.selectedIndex],I(e.value,dom.getOptText(e))}),window.fnAddPartidaInc=(e,a,i)=>dom.validate("#xeco-presto",o.partidas),window.loadPartidaInc=(e,a,i)=>{const o=ab.parse(i.data);o.imp=i18n.toFloat(dom.getValue("#imp-inc")),s.push(o),dom.table("#partidas-tb",s,t,n).setFocus("#org-inc"),w()},dom.onRenderTable("#partidas-tb",e=>{t.imp=0,s.forEach(e=>{t.imp+=e.imp}),dom.eachInput("#ej-dec",e=>dom.toggle(e,"ui-state-disabled",s.length)),dom.eachInput("#ej-inc",e=>dom.toggle(e,"ui-state-disabled",PRESTO.disableEjInc||s.length))}),dom.table("#partidas-tb",s,t,n),window.fnSend=()=>{var e=i18n.get("errRequired");if(dom.validate("#xeco-presto",o.presto),"2"==dom.getValue("#urgente")&&dom.required("#extra","Debe asociar un motivo para la urgencia de esta solicitud",e).geToday("#fMax","Debe indicar una fecha maxima de resolución para esta solicitud"),dom.required("#memoria","Debe asociar una memoria justificativa a la solicitud.",e).required("#org-dec","Debe indicar la partida que disminuye.",e),s.length||dom.addError("#org-inc","Debe seleccionar al menos una partida a aumentar!",e),l&&(dom.required("#imp-dec","Debe indicar el importe de la partida que disminuye.",e),l.imp<t.imp&&dom.addError("#imp-dec","¡Importe máximo de la partida a disminuir excedido!",e)),dom.isOk())return s.sort((e,a)=>a.imp-e.imp),s[0].mask=1|s[0].mask,dom.setValue("#partidas",JSON.stringify(s)),confirm("¿Confirma que desea firmar y enviar esta solicitud?")}});